# Contributor: haru <haru@nak.ics.keio.ac.jp>

pkgname=w3m-patch
origname=w3m
pkgver=0.5.2
pkgrel=1
pkgdesc="A pager/text-based WWW browser with patch"
arch=('i686')
url="http://w3m.sourceforge.net/"
license=('custom')
depends=('openssl' 'gc>=7.0' 'ncurses' 'zlib')
makedepends=()
optdepends=()
source=(http://downloads.sourceforge.net/sourceforge/w3m/$origname-$pkgver.tar.gz
	http://www.j10n.org/files/w3m-cvs-1.914-ambwidth.patch
	http://homepage3.nifty.com/slokar/w3m/w3m-cvs-1.1001-async-4_256-008.patch.gz
	http://www.page.sannet.ne.jp/knabe/w3m/w3m-cvs-1.1001-async-4.diff.gz)
md5sums=('ba06992d3207666ed1bf2dcf7c72bf58'
         'fd4c46bd7c0b46a8a01c1dba8edd36cf'
         'efdcc9366435209f6048a39942b8ec02'
         '7a8ecd411f4e8fec7337aedf1d8cec12')
sha1sums=('484522547ae6dbb342d3858a2a53a65451e273f9'
          'b66e98033cc300c79735882e0b278aa8015ac906'
          '9eb31b8bcf51c59a81dd0896ef88dba07d36390d'
          'c68fe725421acfbf5116bca14f5735eb1c2b1d58')

build() {
  cd "$srcdir/$origname-$pkgver"
  patch -p1 < ../w3m-cvs-1.1001-async-4.diff || return 1
  patch -p1 < ../w3m-cvs-1.1001-async-4_256-008.patch || return 1
  # ignore patch error
  patch -p1 < ../w3m-cvs-1.914-ambwidth.patch || :
  ./configure --prefix=/usr/local --enable-m17n --disable-nls --disable-rpath \
  --enable-image --disable-xface  --disable-gopher --disable-nntp --disable-ipv6 \
  --disable-w3mmailer --enable-external-uri-loader --enable-help-cgi --disable-dict \
  --enable-color --enable-ansi-color --enable-bgcolor --enable-color256
  make -j3 || return 1
  make DESTDIR="${pkgdir}" install || return 1
  install -Dm644 doc/README "${pkgdir}/usr/share/licenses/$pkgname/README"
: << '#comment'
  mkdir -p /usr/local/lib/w3m/
  cp Bonus/* /usr/local/lib/w3m/
#comment
}
